---
title: 커넥션 풀
description: 
author: codongmin
date: 2025-02-01T21:34:00
categories:
  - DBCP
tags: 
image:
  path: /assets/img/thumbnail/.png
  lqip: 
  alt: 이미지 설명
---


## DB 커넥션 풀

대부분의 웹 서비스 구조는 데이터의 영속성을 위해 DB를 사용함. 서버에서 DB에 데이터를 저장하거나 조회하기 위해서는 다음과 같은 3단계가 필요함.

1. DB에 연결하기
2. 쿼리를 실행하기
3. 사용이 끝나면 연결 종료하기

서버는 DB와 **네트워크 통신**으로 연결이 된다. 이때 네트워크 연결은 주로 TCP 프로토콜을 사용하게 되는데, TCP 프로토콜의 주요 특징중 하나는 신뢰성 있는 데이터 전송을 보장한다는 점. 이때 신뢰성 있는(순서보장, 유실보장) 데이터 전송을 위해 **커넥션**이라는 논리적인 연결을 맺는 작업을 수행함. 이런 네트워크 커넥션을 생성하고 종료하는데 걸리는 시간은 대체로 1초 미만~ 1초 이상까지 소요되기도 함. 

사용자의 요청에 대한 응답시간에서 커넥션 **생성/종료 시간이 차지하는 비율은 꽤 큼**. 예를 들어 실행시간이 매우 짧은 쿼리(100ms)를 실행하는 요청의 경우에도 쿼리를 수행하기 위해 필요한 연결/종료 시간이 1초가 걸린다면 DB 연결 시간이 병목지점이 될 수 있음. 

이로 인해 DB 커넥션 생성/종료 시간이 길어지게되면 전체적인 처리량 또한 영향을 받는다. 매 요청마다 연결/종료시간에 많은 시간들이 쓰인다면 트래픽이 증가할때, 전체적인 응답시간이 느려지면서 급격하게 처리량이 저하될 수 있다.

그래서 커넥션 풀이라는 구조를 사용한다. 매번 요청마다 커넥션을 생성/종료하는 시간을 줄이기 위해 **커넥션 재사용** 을 할 수 있는 구조를 의미한다. DB 커넥션 풀은 생성/종료 비용이 많이드는 커넥션을 매 요청마다 만드는 것이 아닌 미리 생성해서 보관할 수 있는 구조로 이루어져 있다. 

전체적인 동작 방식은 다음과 같다.
1. 애플리케이션에서 DB에 쿼리를 수행해야하는 요청이 발생하면,
2. 미리 만들어져 있는 커넥션 풀에서 커넥션을 사용해 작업하고, 
	1. 커넥션은 초기 동작시에 생성되고 이후에 작업을 수행하기 위한 커넥션을 새로 만들지 않는다.
3. 작업이 완료되면 커넥션을 풀에 반환하는 방식으로 동작한다.

커넥션 풀이라는 개념 덕분에 매번 요청마자 커넥션을 만들 필요성이 사라져 응답시간에서 중복되는 오버헤드(커넥션 생성/종료시간)을 제외한 순수 쿼리 수행시간만을 보장받을 수 있게 된다.

이러한 성능적인 장점 덕분에 대부분의 웹 프레임워크나 언어들에서도 이러한 커넥션 풀을 거의 필수적으로 지원하고 있다. 예를 들어 스프링 부트에서는 기본으로 HikariCP라는 고성능 커넥션 풀 구현체를 사용한다.

## DB 커넥션 풀의 다양한 설정들 

DB 커넥션 풀의 구조와 관련된 여러가지 설정들이 존재한다. 이러한 설정들의 값에 따라 성능적이 차이점이 발생하기도 한다.

### 커넥션 풀 크기 

커넥션 풀은 미리 생성된 커넥션들을 담고 있는 **재사용 가능한 커넥션 컨테이너**로 볼 수 있다. 이때 컨테이너에 얼마나 많은 커넥션들을 담고 있을지 결정하는 설정이 커넥션 풀 크기에 관련된 설정들이다.